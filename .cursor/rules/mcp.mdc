---
description: MCP Server Development Template Rules
alwaysApply: false
---
# MCP Server Template Rules

## Core Principles
- Keep it minimal and lightweight
- Use schema-based validation (Zod)
- Import config for file paths, never hardcode
- Follow established patterns, don't break structure

## State Management

### Schema & Types
- **ALWAYS** use `State` type from `schema.ts`: `import { type State } from "../schema.ts"`
- When modifying state structure:
  1. Update `schema.ts` first
  2. Never update `state.yaml` manually, it shall only be created by the server.
  3. Types auto-infer from zod schema

### State Operations
- Use `getState()` to read state
- Use `updateState()` for partial updates
- Use `saveState()` only for complete state replacement
- State is automatically validated on read/write via schema

## File Paths & Configuration

- **ALWAYS** import from `config.ts`: `import { config } from "../config.ts"`
- **NEVER** hardcode file paths like `"./state.yaml"` or `"../changelog.txt"`
- Use `config.stateFile` and `config.logFile`
- Override paths via `Bun.env.STATE_FILE` and `Bun.env.LOG_FILE`

## Tool Registration

- Each tool in separate file: `tools/tool-name.ts`
- Export registration function: `registerToolName`
- Register in `index.ts`: `registerToolName(server);`
- Use snake_case for tool names

## Logging

- **ALWAYS** use log levels: `log("info", tool, req, res)` or `log("error", ...)` or `log("warn", ...)`
- **NEVER** call `log()` without level parameter
- Import from `utils/logger.ts`: `import { log } from "../utils/logger.ts"`

## Project Structure

### Do NOT Modify unless stated by user directly.
- `config.ts` structure (add new config fields if needed)
- `schema.ts` export pattern (update schema content, keep exports)
- `utils/state.ts` deep merge logic
- `utils/logger.ts` signature (level parameter required)

## Code Style

- Use TypeScript strict mode (no "any" types)
- Run `bun run check` to check for errors
- Prefer `type` over `interface` for type inference
- Keep tools focused and single-purpose
- Validate inputs with Zod schemas

## Error Handling

- Tools should handle their own errors and return appropriate MCP responses
- Use try-catch in tools when needed, return error info in response

## Dependencies

- Zod is available for schema validation
- Use Bun built-ins (Bun.file, Bun.write, Bun.env). Refer to use_bun.mdc for more information
- Use the `@` alias for the project root